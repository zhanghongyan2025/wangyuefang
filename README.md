# 民宿业务Web自动化测试项目

## 一、项目概述
本项目是基于Playwright和Pytest构建的民宿业务Web自动化测试框架，采用PO模式设计，覆盖民宿注册、房间备案、管理等核心模块，支持多维度验证及专业报告生成。

## 二、项目结构
```markdown
wangyuefang/
├── pytest.ini	
├── requirements.txt	
├── conf/	# 项目核心配置目录
│   ├── config.py	
│   └── logging_config.py	
└── tests/	# 测试核心目录
    ├── conftest.py
    ├── data/	# 测试数据文件目录
    │   ├── id_card_files/	# 身份证相关测试文件
    │   ├── evidence_files/	# 产权证明、消防安全证明等多格式文件
    │   ├── bedroom_files/	# 卧室区域图片
    │   ├── livingroom_files/	# 客厅区域图片
    │   ├── kitchen_files/	# 厨房区域图片
    │   └── bathroom_files/	# 卫生间区域图片
    ├── pages/	
    │   ├── fd/	# 房东端页面封装
    │   │   ├── add_new_minsu.py	
    │   │   ├── filing_room_page.py	
    │   │   ├── ft_manage_page.py	
    │   │   ├── home_page.py
    │   │   ├── login_page.py	
    │   │   ├── louyu_management.py		
    │   │   ├── minsu_management_page.py	
    │   │   ├── register_page.py	
    │   |   └── room_management_page.py	
    │   └── ga/	# 公安端页面封装
    │       ├── ga_filing_management_page.py	
    │       ├── ga_fw_manage_page.py	
    │       ├── ga_home_page.py	
    │       └── ga_login_page.py	
    ├── prepare/	
    │   ├── prepare_env.sh	# 环境初始化脚本
    │   └── ...	# 其他准备数据
    ├── test_suites/	# 测试用例套件目录
    |   └── fd/	# 房东端测试用例
    |     ├── test_add_new_minsu.py	# 新增民宿功能测试
    |     ├── test_filing_room.py	# 房间备案功能测试
    |     ├── test_login.py	# 登录功能测试
    |     └── ...	# 其他房东端测试
    └── utils/	# 通用工具函数目录
        ├── file_utils.py	# 文件操作工具（上传/校验）
        ├── page_utils.py	# 页面操作工具（元素定位/交互）
        ├── data_generator.py	# 动态数据生成器
        └── form_validation_utils.py	# 表单验证规则库
```

## 三、技术栈与依赖
### 核心技术
- **自动化框架**：Playwright (~=1.55.0) - 支持多浏览器的Web自动化操作
- **测试框架**：Pytest (~=8.4.0) - 测试用例组织与执行
- **报告工具**：
  - pytest-html (~=4.1.1) - HTML格式报告
  - allure-pytest (~=2.13.2) - Allure可视化报告

## 四、测试用例说明
### 1. 登录功能测试
| 场景 | 输入内容 | 预期结果 |
|------|----------|----------|
| 正确账号密码 | 有效账号 + 正确密码 | 跳转至房东端首页 |
| 空账号+任意密码 | `username=""` + 任意密码 | 提示："请输入您的账号" |
| 任意账号+空密码 | 任意账号 + `password=""` | 提示："请输入您的密码" |
| 不存在的账号 | 无效账号 + 任意密码 | 提示："用户不存在或密码错误" |
| 正确账号+错误密码 | 有效账号 + 错误密码 | 提示："用户不存在或密码错误“ |
| 账号锁定状态下登录 | 锁定账号 + 任意密码 | 提示："密码输入错误5次，帐户锁定10分钟" |

### 2. 注册功能测试
| 校验项 | 异常情况 | 预期提示 |
|--------|----------|----------|
| 账户长度 | 小于2字符或大于30字符 | "长度在2到30个字符" |
| 账户长度为2~30字符 | - | "恭喜你，您的账号 xx 注册成功！" |
| 密码长度 | 小于8字符或大于20字符 | "长度在8到20个字符" |
| 密码复杂度 | 无特殊字符/大写/小写/数字 | "需同时包含大小写英文、数字及特殊字符" |
| 密码一致性 | 两次密码不一致 | "确认密码与密码不一致" |
| 验证码失效 | 使用错误验证码/过期验证码 | "验证码错误" |
| 电话号码   | 格式错误/已注册 | "请输入有效的电话号码"/"联系电话已被注册!" |
| 电话号码正确 | - | "恭喜你，您的账号 xx 注册成功！" |
| 用户已被注册 | 已被注册的用户名 | "用户名已存在" |
| 企业用户注册 | 有效数据 | "恭喜你，您的账号 xx 注册成功！" |
| 房东用户注册 | 有效数据 | "恭喜你，您的账号 xx 注册成功！" |


### **3. 新增民宿功能测试**
#### **基础信息空校验**
| 输入字段 | 操作 | 预期提示 |
|----------|------|----------|
| 民宿名称为空 | 提交表单 | "民宿名称不能为空" |
| 行政区划未选 | 提交表单 | "请选择乡 / 镇 / 街道行政区划" |
| 详细地址为空 | 提交表单 | "详细地址不能为空" |
| 正面证件照未上传 | 提交表单 | "请上传负责人证件照 (正面)" |
| 反面证件照未上传 | 提交表单 | "请上传负责人证件照 (反面)" |

#### **基础信息长度校验**
| 字段 | 输入内容 | 预期提示 |
|------|----------|----------|
| 民宿名称 | 超过30个字符 | "最多30个字符" |
| 民宿名称 | 30个字符 | "保存成功" |
| 民宿名称 | 29个字符 | "保存成功" |
| 详细地址 | 超过50个字符 | "最多50个字符" |
| 详细地址 | 50个字符 | "保存成功" |
| 详细地址 | 小于50个字符 | "保存成功" |

#### **身份证上传校验**
| 测试场景 | 文件组合 | 预期提示 |
|----------|----------|----------|
| 合法格式 | 正面: jpg (10MB), 反面: jpeg (10MB) | "保存成功" |
| 合法格式 | 正面: png (10MB), 反面: jpg (10MB) | "保存成功" |
| 边界测试 | 正面: jpg (10MB, 精确边界) | "保存成功" |
| 超限测试 | 正面: png (11MB) | "上传头像图片大小不超过10MB!" |
| 超限测试 | 反面: png (11MB) | "上传头像图片大小不超过10MB!" |
| 双超限测试 | 正反面均为 png (11MB) | "上传头像图片大小不能超过 10 MB! " |
| 非法格式 | 正面: exe | "文件格式不正确, 请上传jpg/jpeg/png图片格式文件!" |
| 非法格式 | 反面: bmp | "文件格式不正确, 请上传jpg/jpeg/png图片格式文件!" |
| 混合非法 | 正面: html + 反面: zip | "文件格式不正确, 请上传jpg/jpeg/png图片格式文件!" |
| 超大+非法 | 正面: png (10MB) + 反面: python脚本 | "上传头像图片大小不能超过 10 MB! " |

#### **正向流程测试**
| 操作步骤 | 预期结果 |
|----------|----------|
| 填写完整合法数据（名称<=30字符、地址<=50字符、合法身份证） | 提交后在列表页显示新民宿，状态为"待审核" |
| 提交后刷新页面 | 数据持久化，无丢失 |
| 重复提交相同数据 | 提示"该民宿已存在" |


### **4. 房间备案功能测试**
#### **基础信息空校验**
| 输入字段 | 操作 | 预期提示 |
|----------|------|----------|
| 房间名称为空 | 提交表单 | "房间名称不能为空" |
| 未选择民宿/楼层/楼宇 | 提交表单 | "请选择民宿/楼层/楼宇" |
| 卧室数量未填 | 提交表单 | "请输入卧室/客厅/厨房/卫生间数量" |
| 房型面积/床数量/最大住人数任一为空 | 提交表单 | "房型面积 (㎡)/ 床数量/最大住人数不能为空" |
| 未选择是否有车位/阳台/窗户 | 提交表单 | "请选择是否有车位/阳台/窗户" |
| 未选择电视机/投影仪 | 提交表单 | "请选择电视机/投影仪" |
| 未选择洗衣机/挂烫机/热水器/吹风机 | 提交表单 | "请选择洗衣机/挂烫机/热水器/吹风机" |
| 未选择冰箱/炉灶/便器 | 提交表单 | "请选择洗冰箱/炉灶/便器" |
| 产权类型为自有但未上传证明 | 提交表单 | "请上传产权证明" |
| 产权类型为租赁但未上传证明 | 提交表单 | "请上传租赁证明" |
| 产权类型为共有但未上传证明 | 提交表单 | "请上传共有产权证明" |

#### **文件上传校验**
| 测试场景 |  预期提示 |
|----------|----------|
| 产权证明文件/消防安全证明/公安登记表单文件超限（10MB+） | "上传文件大小不能超过 10 MB!" |
| 产权证明格式为 HTML/PHP/Python/SVG/TXT/ZIP| "文件格式不正确，请上传 pdf/jpg/jpeg/png格式文件！" |
| 产权证明/消防安全证明/公安登记表上传多个文件 | "上传文件数量不能超过 1 个！" |
| 公安登记表格式为 PHP| "文件格式不正确，请上传 pdf/jpg/jpeg/png格式文件！" |


#### **房间数量格式校验**
| 测试场景 | 输入内容 | 预期结果 |
|----------|----------|----------|
| 卧室/厅/厨房/卫生间数量错误 | 对应input空缺 | "请输入卧室/厅/厨房/卫生间数量" |
| 增加卧室数量| - | 房间数量输入与文件输入框匹配，确保输入合法的房间数 |


#### **单选按钮校验**
| 测试场景  | 预期结果 |
|----------|----------------|
| 选择功能  | 选中状态正确生效 |
| 切换功能  | 验证切换后状态正确更新|
| 初始状态  | 所有单选按钮均为未选中状态 |
| 互斥性    | 同一组内仅最后选择的选项生效 |

#### **文件删除校验**
| 测试场景 |  预期结果 |
|----------|---------|
| 删除自有产权/租赁产权/证明 |  文件被成功删除，页面无该文件记录 |
| 删除自消防安全证明/公安登记表 |文件被成功删除，页面无该文件记录 |

#### **正向流程测试**
| 操作步骤 | 预期结果 |
|----------|----------|
| 填写完整合法数据（必填项+合法文件） | 提交后跳转到成功页面，页面提示”新增成功“ |


### **5. 民宿管理功能测试**
#### **无任何房间的民宿（未提交）**
| 数量| 状态 | 操作集合 | 禁用集合 | 删除结果 |
|------|----|----------|----------|----------|
| 0 | 未提交| ["备案房间", "提交", "修改", "详情", "删除"] | ["提交"] | 直接删除成功 |


#### **有房间的民宿（未提交）**
| 数量 | 状态 | 操作集合  | 删除结果 |
|------|----|----------|----------|
| 1    | 未提交 | ["备案房间", "提交", "修改", "详情", "删除"] | 民宿下存在有效房间,删除失败，先注销房间再删除民宿成功 |


#### **有房间的民宿（已提交）**
|数量 | 状态 | 操作集合 |  删除结果 |
|------|----|----------|----------|
| 1 | 待确认 | ["详情"] |    |          

#### **有房间的民宿（已确认）**
| 数量 | 状态 | 操作集合 |  删除结果 |
|------|----|----------|----------|
| 1 | 已确认 | ["备案房间","详情", "删除"] |  民宿下存在有效房间,删除失败，先注销房间再删除民宿成功 |


### 6. 房间管理功能测试
| 操作 |状态 |操作集合 |
|----------|-------|-------|
| | 正常|["修改", "禁用", "注销", "详情"] |
| 禁用 |禁用 |["修改", "恢复", "注销", "详情"]  |
| 恢复 |正常 |["修改", "禁用", "注销", "详情"] |
| 注销 |注销 |["详情"] |


### 7. 楼宇管理功能测试**
#### **新增楼宇**
| 输入字段 | 操作 | 预期提示 |
|----------|------|----------|
| 名称为空 | 提交表单 | "楼宇名称不能为空" |
| 名称长度1字符 | 提交表单 | "新增成功" |
| 名称长度30字符 | 提交表单 | "新增成功" |
| 名称长度超过30字符 | 提交表单 | "最多30个字符" |
| 已存在名称（重复提交） | 提交表单 | "楼宇名称已存在" |

#### **修改楼宇**
| 操作场景 | 输入内容 | 预期结果 |
|----------|----------|----------|
| 未修改直接提交 | 保持原值 | "修改成功" |
| 合法修改（30字符） | 新名称 | "修改成功" |
| 非法修改（超过30字符） | 新名称 | "最多30个字符" |
| 重复名称修改 | 已存在名称 | "楼宇名称已存在" |

#### **删除楼宇**
| 前置条件 | 操作 | 预期结果 |
|----------|------|----------|
| 无有效房间 | 执行删除 | "删除成功" |
| 有有效房间 | 执行删除 | "楼宇下存在有效房间,删除失败" |



## 五、 **环境配置**
### **前置条件**
- Python 3.8+
- 浏览器：Chrome、Firefox、WebKit（Playwright自动管理驱动）

### **安装步骤**
1. **克隆仓库**  
   ```bash
   git clone https://github.com/your-repo/wangyuefang.git
   cd wangyuefang
   ```

2. **安装依赖包**  
   ```bash
   pip install -r requirements.txt
   ```

3. **安装Playwright浏览器驱动**  
   ```bash
   playwright install
   ```

### **测试执行**
1. **基本命令**  
   ```bash
   # 全量测试执行
   pytest tests/ --html=report.html
   
   # Allure报告生成
   pytest tests/ --alluredir=allure-results && allure serve allure-results
   ```

## 六、 **Jenkins集成配置**
### **1. 源码管理配置（Subversion）**
- **插件**：SVN Repository Plugin
- **配置**：
  - **Repository URL**: `https://svn.example.com/path/to/wangyuefang`
  - **Credentials**: Jenkins预置的SVN访问凭证

### **2. 构建步骤配置（Execute shell）**
```bash
#!/bin/bash
# 拉取最新代码
svn update --username=user --password=pass /var/jenkins_home/workspace/wangyuefang
# 安装依赖
pip install -r requirements.txt
# 生成Allure报告
pytest tests/ --alluredir=allure-results
# 启动Allure服务器
allure serve allure-results
```

### **3. 构建后操作配置（Allure Report）**
- **插件**：Allure Jenkins Plugin
- **配置**：
  - **Report Path**: `allure-results`
  - **Display Name**: "Allure Report"
  - **Successful Build Only**: 不勾选（始终展示报告）

### **4. 结果查看**
- **Allure Report**：构建完成后点击构建记录旁的 "Allure Report" 标签。
- **控制台日志**：点击构建记录，选择 "Console Output" 查看详细执行日志。

---

### **Allure Report核心功能解析**
1. **交互式分析**  
   - **失败定位**：点击失败用例，红色框标注前端提示位置，结合断言信息判断是否符合预期。
   - **参数化复现**：通过 `Parameters` 面板验证不同场景的数据组合。
   - **趋势分析**：对比多轮测试的通过率变化（如 `Graphs` 面板）。

2. **质量追溯**  
   - **缺陷关联**：支持与 Jira/Bugzilla 联动，直接跳转查看关联缺陷。
   - **环境信息**：报告中自动记录测试环境（Python版本、浏览器驱动等）。


### **Jenkins优势总结**
| 优势                | 具体体现                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **全流程自动化**     | 从代码拉取到报告生成，减少人工干预，避免环境差异问题。                    |
| **灵活触发机制**     | 支持定时/代码提交/手动触发，适配回归测试、分支验证、紧急修复等场景。      |
| **多工具集成**       | 无缝对接Pytest、Playwright、Allure，支持邮件/钉钉实时告警。               |
| **可视化监控**       | 实时显示测试进度、通过率，支持多维度图表分析（状态分布、耗时趋势）。        |
| **可扩展性**         | 支持Pipeline脚本自定义流程，未来可扩展分布式执行或新增测试模块。            |

